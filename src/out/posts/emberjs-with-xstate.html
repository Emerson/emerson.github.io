<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/07a3c9a81710865f09de.css" as="style"/><link rel="stylesheet" href="/_next/static/css/07a3c9a81710865f09de.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-529038c3904b00e40c00.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.15878d4e523f86636251.js" as="script"/><link rel="preload" href="/_next/static/chunks/ef4d5ca1bb17fc2558817e2fd8d6e7eaac76ba76.2b2e1b1126c91ea98096.js" as="script"/><link rel="preload" href="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.edb164a1134a6009303e.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-734e83a538b3a5a416d1.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-4e6e1079dcade38a9395.js" as="script"/><link rel="preload" href="/_next/static/chunks/9f96d65d.e84e24a909b34e545eb6.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-0860a7ce36a19bae1b80.js" as="script"/></head><body><div id="__next"><div class="container"><section class="article markdown-body"><a href="/">back</a><h1>Using EmberJS with XState</h1><p><img src="/emberjs-with-xstate/ember-plus-xstate.png" alt="Ember with XState"/></p>
<blockquote>
<p>“Machines take me by surprise with great frequency”</p>
<ul>
<li>Alan Turing</li>
</ul>
</blockquote>
<p><a href="https://github.com/Emerson/emberjs-xstate-example">Full Source Available on Github</a></p>
<p>After some experimentation with state machines and EmberJS, I figured it would be worth sharing some of our learnings with the broader JavaScript community. We’ve only just started building out components with <a href="https://xstate.js.org/">XState</a>, but I think we’re seeing the value already and plan to continue using it when building new components.</p>
<h3>What are the benefits?</h3>
<ul>
<li>It forces us to reconcile component states upfront during planning</li>
<li>It’s a framework agnostic way of defining presentational state</li>
<li>It’s easy to unit test</li>
<li>You can generate state diagrams from the code you write</li>
<li>Template code can be greatly simplified</li>
<li>It eliminates emergent states by definition explicit states</li>
</ul>
<h3>What are the drawbacks?</h3>
<ul>
<li>It’s yet another dependency</li>
<li>XState has large conceptual overhead with lots of esoteric concepts</li>
<li>It’s confusing if you don’t have experience with it</li>
</ul>
<h3>The Plan</h3>
<p>This is a contrived example, but I think it goes far enough to demonstrate the basics of using XState with EmberJS. We’re going to look at how we could use XState and Ember to implement a <em>(very)</em> basic signup form.</p>
<p>I won’t be explaining XState in great detail, for that I would suggest watching the <a href="https://egghead.io/courses/introduction-to-state-machines-using-xstate">free video series on egghead.io</a>. Instead, this article will introduce some basic concepts and demonstrate how we develop XState powered components in Ember.</p>
<h3>The Form</h3>
<p>Let’s talk about this signup form. It’s going to have two fields, a submit button, an error state, and a success state. Check out the GIF below to see an example:</p>
<p><img src="/emberjs-with-xstate/state-machine-example.gif" alt="Screenshot"/></p>
<p>When the user puts in any value for <code>username</code> and <code>password</code> we will display a success message. Otherwise we will display an error message and allow them to retry.</p>
<h3>The State machine</h3>
<p>In abstract terms, this form will have 4 possible states: <code>idle</code>, <code>saving</code>, <code>success</code>, and <code>error</code>. Within XState we use the <code>createMachine</code> method to start defining our machine. The basic shape of an XState machine looks like this:</p>
<pre><div style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8"><span class="token module" style="color:#8fc13e">import</span><span> </span><span class="token imports" style="color:#b9b5b8">{</span><span class="token imports"> createMachine </span><span class="token imports" style="color:#b9b5b8">}</span><span> </span><span class="token module" style="color:#8fc13e">from</span><span> </span><span class="token" style="color:#149b93">&#x27;xstate&#x27;</span><span class="token" style="color:#b9b5b8">;</span><span>
</span>
<span></span><span class="token function">createMachine</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>  id</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;signup-form&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  initial</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;idle&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  states</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    idle</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    saving</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    success</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    error</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span></span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span></code></div></pre>
<p>What’s so nice about this is that you can paste your code into the <a href="https://xstate.js.org/viz/">XState Visualizer</a> and generate an visual of how your state machine operates – 🎉 super handy! 🎉</p>
<p><img src="/emberjs-with-xstate/initial-states.png" alt="XState Visualization 1"/></p>
<h3>Moving Between States</h3>
<p>Our state machine is not very useful yet. As defined, it cannot transition between states. To enable that, we need to define <a href="https://xstate.js.org/docs/guides/events.html">events</a> for each state using the <a href="https://xstate.js.org/docs/guides/transitions.html"><code>on</code> property</a>.</p>
<pre><div style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8"><span class="token module" style="color:#8fc13e">import</span><span> </span><span class="token imports" style="color:#b9b5b8">{</span><span class="token imports"> createMachine </span><span class="token imports" style="color:#b9b5b8">}</span><span> </span><span class="token module" style="color:#8fc13e">from</span><span> </span><span class="token" style="color:#149b93">&#x27;xstate&#x27;</span><span class="token" style="color:#b9b5b8">;</span><span>
</span>
<span></span><span class="token function">createMachine</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>  id</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;signup-form&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  initial</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;idle&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  states</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    idle</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      on</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token constant">SUBMIT</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;saving&#x27;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    saving</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      on</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token constant">SUCCESS</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;success&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>        </span><span class="token constant">ERROR</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;error&#x27;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    success</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    error</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      on</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token constant">RETRY</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;idle&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span></span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span>
</code></div></pre>
<p>With our events defined, our state visualization starts to make a little more sense and we can now transition between states by sending our state machine an event.</p>
<p><img src="/emberjs-with-xstate/states-with-transitions.png" alt="XState Visualization 2"/></p>
<pre><div style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8"><span class="token" style="color:#797379">//=&gt; This would transition our machine to the `saving` state</span><span>
</span><span>machine</span><span class="token" style="color:#b9b5b8">.</span><span class="token method function property-access">send</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">{</span><span>type</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;SUBMIT&#x27;</span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span></code></div></pre>
<h3>The Context Object</h3>
<p>The next XState concept I want to touch on is the <a href="https://xstate.js.org/docs/guides/context.html"><code>context</code> object</a>. This is an object defined within our state machine that allows you to persist and pass around data. In our case we are going to store the <code>username</code> and <code>password</code>.</p>
<pre><div style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8"><span class="token module" style="color:#8fc13e">import</span><span> </span><span class="token imports" style="color:#b9b5b8">{</span><span class="token imports"> createMachine </span><span class="token imports" style="color:#b9b5b8">}</span><span> </span><span class="token module" style="color:#8fc13e">from</span><span> </span><span class="token" style="color:#149b93">&#x27;xstate&#x27;</span><span class="token" style="color:#b9b5b8">;</span><span>
</span>
<span></span><span class="token function">createMachine</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>  id</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;signup-form&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  initial</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;idle&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  </span><span class="token" style="color:#797379">// Lets add some context...</span><span>
</span><span>  context</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    username</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    password</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  states</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    idle</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      on</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token constant">SUBMIT</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;saving&#x27;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    saving</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      on</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token constant">SUCCESS</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;success&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>        </span><span class="token constant">ERROR</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;error&#x27;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    success</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    error</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      on</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token constant">RETRY</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;idle&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span></span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span></code></div></pre>
<p>There are a number of ways to set values on this context object, I’m going to give a simple example using an <code>action</code> callback. To learn more about actions I’d suggest <a href="https://xstate.js.org/docs/guides/actions.html">checking out the docs</a>, there is a lot to unpack.</p>
<pre><div style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8"><span class="token" style="color:#797379">// When sending an event to the state machine you can pass extra data that becomes available in `action` callbacks</span><span>
</span><span>machine</span><span class="token" style="color:#b9b5b8">.</span><span class="token method function property-access">send</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>  type</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;SUBMIT&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  username</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;joe&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  password</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;password123&#x27;</span><span>
</span><span></span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span>
<span></span><span class="token" style="color:#797379">// ...</span><span>
</span><span></span><span class="token" style="color:#797379">// definition of our `idle` state</span><span>
</span><span>idle</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>  on</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    </span><span class="token constant">SUBMIT</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      target</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;saving&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span> </span><span class="token" style="color:#797379">// transition to `saving`</span><span>
</span><span>      actions</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">[</span><span>
</span><span>        </span><span class="token" style="color:#8fc13e">function</span><span class="token" style="color:#b9b5b8">(</span><span class="token parameter">context</span><span class="token parameter" style="color:#b9b5b8">,</span><span class="token parameter"> eventPayload</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>          </span><span class="token" style="color:#797379">// eventPayload is the object we send to the machine</span><span>
</span><span>          context</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">username</span><span> </span><span class="token" style="color:#fd8b19">=</span><span> eventPayload</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">username</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>          context</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">password</span><span> </span><span class="token" style="color:#fd8b19">=</span><span> eventPayload</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">password</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>        </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">]</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span></span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span></span><span class="token" style="color:#797379">// ...</span></code></div></pre>
<h3>Saving the user (well… faking it anyway)</h3>
<p>There are times when you may want a transition to be contingent on the results of an async operation. In our example, when the form is submitted we would likely hit the API and depending the result, transition to either the <code>success</code> or <code>error</code> state.</p>
<p>To accomplish this we can use the <a href="https://xstate.js.org/docs/guides/communication.html"><code>invoke</code> property</a> when defining our <code>saving</code> state. There is a lot to know about <code>invoke</code>, but in its most simple form it allows you to register a callback that returns a promise. In our case if the promise is <code>resolved</code> we want to transition to the <code>success</code> state, and if it’s <code>rejected</code> we want to transition to the <code>error</code> state.</p>
<p>This looks something like this:</p>
<pre><div style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8"><span>
</span><span></span><span class="token" style="color:#797379">// We define a &quot;service&quot; (callback) to invoke that returns a promise.</span><span>
</span><span></span><span class="token" style="color:#797379">// In our case I am trying to mock out an API call... notice how this callback recives the context object</span><span>
</span><span></span><span class="token" style="color:#8fc13e">function</span><span> </span><span class="token function">fakeServerResponse</span><span class="token" style="color:#b9b5b8">(</span><span class="token parameter">context</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>  </span><span class="token control-flow" style="color:#8fc13e">return</span><span> </span><span class="token" style="color:#8fc13e">new</span><span> </span><span class="token class-name">Promise</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">(</span><span class="token parameter">resolve</span><span class="token parameter" style="color:#b9b5b8">,</span><span class="token parameter"> reject</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token arrow" style="color:#fd8b19">=&gt;</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    </span><span class="token function">later</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token arrow" style="color:#fd8b19">=&gt;</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      </span><span class="token control-flow" style="color:#8fc13e">if</span><span> </span><span class="token" style="color:#b9b5b8">(</span><span>context</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">username</span><span> </span><span class="token" style="color:#fd8b19">&amp;&amp;</span><span> context</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">password</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token function">resolve</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#149b93">&#x27;Valid!&#x27;</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span> </span><span class="token control-flow" style="color:#8fc13e">else</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token function">reject</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#149b93">&#x27;Invalid!&#x27;</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span> </span><span class="token" style="color:#fd8b19">1000</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span></span><span class="token" style="color:#b9b5b8">}</span><span>
</span>
<!-- -->
<span></span><span class="token" style="color:#797379">// ...</span><span>
</span><span></span><span class="token" style="color:#797379">// definition of our `saving` state</span><span>
</span><span>saving</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>  invoke</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    id</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;fakeServerResponse&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    src</span><span class="token" style="color:#fd8b19">:</span><span> fakeServerResponse</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    onDone</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      target</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;success&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    onError</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      target</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;error&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span></span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span></span><span class="token" style="color:#797379">// ...</span></code></div></pre>
<h3>The Final State Machine</h3>
<p>Below you will find the state machine in its entirety. I’ve made some slight adjustments to the action callback and added a couple extra properties, but it’s largely the same as we defined above.  The resulting state visualization awesome. Think about how helpful this could be when looking at a pull request.</p>
<pre><div style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8"><span class="token" style="color:#8fc13e">function</span><span> </span><span class="token function">fakeServerResponse</span><span class="token" style="color:#b9b5b8">(</span><span class="token parameter">context</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>  </span><span class="token control-flow" style="color:#8fc13e">return</span><span> </span><span class="token" style="color:#8fc13e">new</span><span> </span><span class="token class-name">Promise</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">(</span><span class="token parameter">resolve</span><span class="token parameter" style="color:#b9b5b8">,</span><span class="token parameter"> reject</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token arrow" style="color:#fd8b19">=&gt;</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    </span><span class="token function">later</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token arrow" style="color:#fd8b19">=&gt;</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      </span><span class="token control-flow" style="color:#8fc13e">if</span><span> </span><span class="token" style="color:#b9b5b8">(</span><span>context</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">username</span><span> </span><span class="token" style="color:#fd8b19">&amp;&amp;</span><span> context</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">password</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token function">resolve</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#149b93">&#x27;Valid!&#x27;</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span> </span><span class="token control-flow" style="color:#8fc13e">else</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token function">reject</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#149b93">&#x27;Invalid!&#x27;</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span> </span><span class="token" style="color:#fd8b19">1000</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span></span><span class="token" style="color:#b9b5b8">}</span><span>
</span>
<span></span><span class="token" style="color:#8fc13e">let</span><span> signupFormMachine </span><span class="token" style="color:#fd8b19">=</span><span> </span><span class="token function">createMachine</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>  id</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;signup-form&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  initial</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;idle&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  context</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    username</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    password</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  states</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    idle</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      on</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token constant">SUBMIT</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>          target</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;saving&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>          actions</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">[</span><span>
</span><span>            </span><span class="token function">assign</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>              </span><span class="token function-variable function">username</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">(</span><span class="token parameter">context</span><span class="token parameter" style="color:#b9b5b8">,</span><span class="token parameter"> event</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token arrow" style="color:#fd8b19">=&gt;</span><span> event</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">username</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>              </span><span class="token function-variable function">password</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">(</span><span class="token parameter">context</span><span class="token parameter" style="color:#b9b5b8">,</span><span class="token parameter"> event</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token arrow" style="color:#fd8b19">=&gt;</span><span> event</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">password</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>            </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>          </span><span class="token" style="color:#b9b5b8">]</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>        </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    saving</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      invoke</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        id</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;fakeServerResponse&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>        src</span><span class="token" style="color:#fd8b19">:</span><span> fakeServerResponse</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>        onDone</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>          target</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;success&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>        </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>        onError</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>          target</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;error&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>        </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    success</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      type</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;final&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    error</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      on</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>        </span><span class="token constant">RETRY</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;idle&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span></span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span></code></div></pre>
<p><img src="/emberjs-with-xstate/final-state-machine.png" alt="Final State Machine"/></p>
<h3>What About Ember?</h3>
<p>This is actually the easy part! The basic premise here is that we instantiate our state machine within the constructor of our component. This allows us to hook into a <code>onTransition</code> callback that is exposed by XState. Every time our machine transitions, we update the <code>state</code> attribute of the component. This allows us to use simple logic in the component template to show or hide particular UI.</p>
<p>We also add two actions to the component. One that handles general <code>send</code> events to our machine and another that handles the form submit. I think it’s pretty self explanatory if you’re familiar with Ember.</p>
<pre><div style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8"><span class="token module" style="color:#8fc13e">import</span><span> </span><span class="token imports maybe-class-name">Component</span><span> </span><span class="token module" style="color:#8fc13e">from</span><span> </span><span class="token" style="color:#149b93">&#x27;@glimmer/component&#x27;</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span></span><span class="token module" style="color:#8fc13e">import</span><span> </span><span class="token imports" style="color:#b9b5b8">{</span><span class="token imports"> tracked </span><span class="token imports" style="color:#b9b5b8">}</span><span> </span><span class="token module" style="color:#8fc13e">from</span><span> </span><span class="token" style="color:#149b93">&#x27;@glimmer/tracking&#x27;</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span></span><span class="token module" style="color:#8fc13e">import</span><span> </span><span class="token imports" style="color:#b9b5b8">{</span><span class="token imports"> action </span><span class="token imports" style="color:#b9b5b8">}</span><span> </span><span class="token module" style="color:#8fc13e">from</span><span> </span><span class="token" style="color:#149b93">&#x27;@ember/object&#x27;</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span></span><span class="token module" style="color:#8fc13e">import</span><span> </span><span class="token imports" style="color:#b9b5b8">{</span><span class="token imports"> later </span><span class="token imports" style="color:#b9b5b8">}</span><span> </span><span class="token module" style="color:#8fc13e">from</span><span> </span><span class="token" style="color:#149b93">&#x27;@ember/runloop&#x27;</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span></span><span class="token module" style="color:#8fc13e">import</span><span> </span><span class="token imports" style="color:#b9b5b8">{</span><span class="token imports"> createMachine</span><span class="token imports" style="color:#b9b5b8">,</span><span class="token imports"> interpret</span><span class="token imports" style="color:#b9b5b8">,</span><span class="token imports"> assign </span><span class="token imports" style="color:#b9b5b8">}</span><span> </span><span class="token module" style="color:#8fc13e">from</span><span> </span><span class="token" style="color:#149b93">&#x27;xstate&#x27;</span><span class="token" style="color:#b9b5b8">;</span><span>
</span>
<span></span><span class="token" style="color:#797379">// We would define the state machine here and assign it to a variable named </span><span>
</span><span></span><span class="token" style="color:#797379">// `signupFormMachine`. I&#x27;ve left this out for the sake of brevity, but you can see</span><span>
</span><span></span><span class="token" style="color:#797379">// it in the full source if needed.</span><span>
</span><span></span><span class="token" style="color:#797379">//</span><span>
</span><span></span><span class="token" style="color:#8fc13e">let</span><span> signupFormMachine </span><span class="token" style="color:#fd8b19">=</span><span> </span><span class="token function">createMachine</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#797379">/* machine defined here */</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span>
<span></span><span class="token module" style="color:#8fc13e">export</span><span> </span><span class="token module" style="color:#8fc13e">default</span><span> </span><span class="token" style="color:#8fc13e">class</span><span> </span><span class="token class-name">SignupFormComponent</span><span> </span><span class="token" style="color:#8fc13e">extends</span><span> </span><span class="token class-name">Component</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>  @tracked state</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>  @tracked username</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>  @tracked password</span><span class="token" style="color:#b9b5b8">;</span><span>
</span>
<span>  </span><span class="token function">constructor</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    </span><span class="token" style="color:#8fc13e">super</span><span class="token" style="color:#b9b5b8">(</span><span class="token spread" style="color:#fd8b19">...</span><span>arguments</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>    </span><span class="token" style="color:#8fc13e">this</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">machine</span><span> </span><span class="token" style="color:#fd8b19">=</span><span> </span><span class="token function">interpret</span><span class="token" style="color:#b9b5b8">(</span><span>signupFormMachine</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>    </span><span class="token" style="color:#8fc13e">this</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">machine</span><span class="token" style="color:#b9b5b8">.</span><span class="token method function property-access">start</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>    </span><span class="token" style="color:#8fc13e">this</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">machine</span><span class="token" style="color:#b9b5b8">.</span><span class="token method function property-access">onTransition</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">(</span><span class="token parameter">state</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token arrow" style="color:#fd8b19">=&gt;</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      </span><span class="token" style="color:#8fc13e">this</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">state</span><span> </span><span class="token" style="color:#fd8b19">=</span><span> state</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">value</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span>
</span>
<!-- -->  @action
<span>  </span><span class="token function">send</span><span class="token" style="color:#b9b5b8">(</span><span class="token parameter">eventName</span><span class="token parameter" style="color:#b9b5b8">,</span><span class="token parameter"> e</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    e</span><span class="token" style="color:#b9b5b8">.</span><span class="token method function property-access">preventDefault</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>    </span><span class="token" style="color:#8fc13e">this</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">machine</span><span class="token" style="color:#b9b5b8">.</span><span class="token method function property-access">send</span><span class="token" style="color:#b9b5b8">(</span><span>eventName</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span>
</span>
<!-- -->  @action
<span>  </span><span class="token function">submit</span><span class="token" style="color:#b9b5b8">(</span><span class="token parameter">e</span><span class="token" style="color:#b9b5b8">)</span><span> </span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>    e</span><span class="token" style="color:#b9b5b8">.</span><span class="token method function property-access">preventDefault</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>    </span><span class="token" style="color:#8fc13e">this</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">machine</span><span class="token" style="color:#b9b5b8">.</span><span class="token method function property-access">send</span><span class="token" style="color:#b9b5b8">(</span><span class="token" style="color:#b9b5b8">{</span><span>
</span><span>      type</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#149b93">&#x27;SUBMIT&#x27;</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>      username</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#8fc13e">this</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">username</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>      password</span><span class="token" style="color:#fd8b19">:</span><span> </span><span class="token" style="color:#8fc13e">this</span><span class="token" style="color:#b9b5b8">.</span><span class="token property-access">password</span><span class="token" style="color:#b9b5b8">,</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">}</span><span class="token" style="color:#b9b5b8">)</span><span class="token" style="color:#b9b5b8">;</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">}</span><span>
</span><span></span><span class="token" style="color:#b9b5b8">}</span></code></div></pre>
<h3>Show Me the Handlebars!</h3>
<p>Alright, so let&#x27;s check out the component template. It’s pretty clean and easy to read since everything is relying on the state machine. The big things I like about this are:</p>
<ul>
<li>There is no potential for weird emergent states. Our template conditionals are very clearly defined in simple  <code>#if</code> blocks using <code>ember-truth-helper</code> subexpressions.</li>
<li>For simple button clicks, we can just use the <code>(fn this.send &#x27;EVENT_NAME&#x27;)</code> pattern to proxy messages directly to the state machine.</li>
<li>If we need to do some extra work before sending an event to the state machine you can use a standard ember action like we’ve done on the form submit event.</li>
</ul>
<pre><div style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8;padding:1em;margin:.5em 0;overflow:auto"><code class="language-handlebars" style="font-family:&quot;Fira Mono&quot;, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:16px;line-height:1.375;direction:ltr;text-align:left;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;word-break:break-all;word-wrap:break-word;background:#322931;color:#b9b5b8"><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">{{</span><span class="token handlebars language-handlebars block" style="color:#8fc13e">#if</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#b9b5b8">(</span><span class="token handlebars language-handlebars" style="color:#1290bf">or</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#b9b5b8">(</span><span class="token handlebars language-handlebars" style="color:#1290bf">eq</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#1290bf">this</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">.</span><span class="token handlebars language-handlebars" style="color:#1290bf">state</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#149b93">&#x27;idle&#x27;</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">)</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#b9b5b8">(</span><span class="token handlebars language-handlebars" style="color:#1290bf">eq</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#1290bf">this</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">.</span><span class="token handlebars language-handlebars" style="color:#1290bf">state</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#149b93">&#x27;saving&#x27;</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">)</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">)</span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">}}</span><span>
</span>
<span>  </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">form</span><span class="token" style="color:#1290bf"> </span><span class="token handlebars language-handlebars delimiter" style="color:#fd8b19">{{</span><span class="token handlebars language-handlebars" style="color:#fd8b19">on</span><span class="token handlebars language-handlebars" style="color:#fd8b19"> </span><span class="token handlebars language-handlebars" style="color:#fd8b19">&#x27;submit&#x27;</span><span class="token handlebars language-handlebars" style="color:#fd8b19"> </span><span class="token handlebars language-handlebars" style="color:#fd8b19">this</span><span class="token handlebars language-handlebars" style="color:#fd8b19">.</span><span class="token handlebars language-handlebars" style="color:#fd8b19">submit</span><span class="token handlebars language-handlebars delimiter" style="color:#fd8b19">}}</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">class</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">signup-form</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">autocomplete</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">off</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span>
<span>    </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">div</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">class</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">field</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">label</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">for</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">username</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#b9b5b8">&gt;</span><span>Username</span><span class="token" style="color:#b9b5b8">&lt;/</span><span class="token" style="color:#1290bf">label</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">Input</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">@id</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">username</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">@type</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">text</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">@value</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token handlebars language-handlebars delimiter" style="color:#8fc13e">{{</span><span class="token handlebars language-handlebars" style="color:#8fc13e">this</span><span class="token handlebars language-handlebars" style="color:#8fc13e">.</span><span class="token handlebars language-handlebars" style="color:#8fc13e">username</span><span class="token handlebars language-handlebars delimiter" style="color:#8fc13e">}}</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#b9b5b8">/&gt;</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">&lt;/</span><span class="token" style="color:#1290bf">div</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span>
<span>    </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">div</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">class</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">field</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">label</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">for</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">password</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#b9b5b8">&gt;</span><span>Password</span><span class="token" style="color:#b9b5b8">&lt;/</span><span class="token" style="color:#1290bf">label</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">Input</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">@id</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">password</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">@type</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">password</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">@value</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token handlebars language-handlebars delimiter" style="color:#8fc13e">{{</span><span class="token handlebars language-handlebars" style="color:#8fc13e">this</span><span class="token handlebars language-handlebars" style="color:#8fc13e">.</span><span class="token handlebars language-handlebars" style="color:#8fc13e">password</span><span class="token handlebars language-handlebars delimiter" style="color:#8fc13e">}}</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#b9b5b8">/&gt;</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">&lt;/</span><span class="token" style="color:#1290bf">div</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span>
<span>    </span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">{{</span><span class="token handlebars language-handlebars block" style="color:#8fc13e">#if</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#b9b5b8">(</span><span class="token handlebars language-handlebars" style="color:#1290bf">eq</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#1290bf">this</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">.</span><span class="token handlebars language-handlebars" style="color:#1290bf">state</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#149b93">&#x27;idle&#x27;</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">)</span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">}}</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">input</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">type</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">submit</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">value</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">Create User</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#b9b5b8">/&gt;</span><span>
</span><span>    </span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">{{</span><span class="token handlebars language-handlebars block" style="color:#8fc13e">/if</span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">}}</span><span>
</span>
<span>    </span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">{{</span><span class="token handlebars language-handlebars block" style="color:#8fc13e">#if</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#b9b5b8">(</span><span class="token handlebars language-handlebars" style="color:#1290bf">eq</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#1290bf">this</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">.</span><span class="token handlebars language-handlebars" style="color:#1290bf">state</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#149b93">&#x27;saving&#x27;</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">)</span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">}}</span><span>
</span><span>      </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">input</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">type</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">submit</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">value</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">Saving...</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">disabled</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#b9b5b8">/&gt;</span><span>
</span><span>    </span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">{{</span><span class="token handlebars language-handlebars block" style="color:#8fc13e">/if</span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">}}</span><span>
</span>
<span>  </span><span class="token" style="color:#b9b5b8">&lt;/</span><span class="token" style="color:#1290bf">form</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span>
<span></span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">{{</span><span class="token handlebars language-handlebars block" style="color:#8fc13e">/if</span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">}}</span><span>
</span>
<span></span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">{{</span><span class="token handlebars language-handlebars block" style="color:#8fc13e">#if</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#b9b5b8">(</span><span class="token handlebars language-handlebars" style="color:#1290bf">eq</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#1290bf">this</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">.</span><span class="token handlebars language-handlebars" style="color:#1290bf">state</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#149b93">&#x27;success&#x27;</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">)</span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">}}</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">div</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">class</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">success</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">p</span><span class="token" style="color:#b9b5b8">&gt;</span><span>⭐️ User created!</span><span class="token" style="color:#b9b5b8">&lt;/</span><span class="token" style="color:#1290bf">p</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">&lt;/</span><span class="token" style="color:#1290bf">div</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span><span></span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">{{</span><span class="token handlebars language-handlebars block" style="color:#8fc13e">/if</span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">}}</span><span>
</span>
<span></span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">{{</span><span class="token handlebars language-handlebars block" style="color:#8fc13e">#if</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#b9b5b8">(</span><span class="token handlebars language-handlebars" style="color:#1290bf">eq</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#1290bf">this</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">.</span><span class="token handlebars language-handlebars" style="color:#1290bf">state</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars" style="color:#149b93">&#x27;error&#x27;</span><span class="token handlebars language-handlebars" style="color:#b9b5b8">)</span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">}}</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">div</span><span class="token" style="color:#1290bf"> </span><span class="token" style="color:#fd8b19">class</span><span class="token attr-equals" style="color:#b9b5b8">=</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#8fc13e">error</span><span class="token" style="color:#b9b5b8">&quot;</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">p</span><span class="token" style="color:#b9b5b8">&gt;</span><span>🚫 There was an error submitting the form</span><span class="token" style="color:#b9b5b8">&lt;/</span><span class="token" style="color:#1290bf">p</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#b9b5b8">&lt;</span><span class="token" style="color:#1290bf">button</span><span class="token" style="color:#1290bf"> </span><span class="token handlebars language-handlebars delimiter" style="color:#fd8b19">{{</span><span class="token handlebars language-handlebars" style="color:#fd8b19">on</span><span class="token handlebars language-handlebars" style="color:#fd8b19"> </span><span class="token handlebars language-handlebars" style="color:#fd8b19">&#x27;click&#x27;</span><span class="token handlebars language-handlebars" style="color:#fd8b19"> </span><span class="token handlebars language-handlebars" style="color:#fd8b19">(</span><span class="token handlebars language-handlebars" style="color:#fd8b19">fn</span><span class="token handlebars language-handlebars" style="color:#fd8b19"> </span><span class="token handlebars language-handlebars" style="color:#fd8b19">this</span><span class="token handlebars language-handlebars" style="color:#fd8b19">.</span><span class="token handlebars language-handlebars" style="color:#fd8b19">send</span><span class="token handlebars language-handlebars" style="color:#fd8b19"> </span><span class="token handlebars language-handlebars" style="color:#fd8b19">&#x27;RETRY&#x27;</span><span class="token handlebars language-handlebars" style="color:#fd8b19">)</span><span class="token handlebars language-handlebars delimiter" style="color:#fd8b19">}}</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span>      Try Again...
<span>    </span><span class="token" style="color:#b9b5b8">&lt;/</span><span class="token" style="color:#1290bf">button</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#b9b5b8">&lt;/</span><span class="token" style="color:#1290bf">div</span><span class="token" style="color:#b9b5b8">&gt;</span><span>
</span><span></span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">{{</span><span class="token handlebars language-handlebars block" style="color:#8fc13e">/if</span><span class="token handlebars language-handlebars delimiter" style="color:#b9b5b8">}}</span></code></div></pre>
<p>I hope this has been a somewhat compelling introduction to using XState and EmberJS. If you have any questions or comments feel free to reach out on <a href="https://twitter.com/emerson_lackey">Twitter</a> or on the EmberJS Discourse.</p></section></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"emberjs-with-xstate","title":"Using EmberJS with XState","date":"2021-06-09","content":"\n![Ember with XState](/emberjs-with-xstate/ember-plus-xstate.png)\n\n\u003e “Machines take me by surprise with great frequency”\n\u003e - Alan Turing\n\n[Full Source Available on Github](https://github.com/Emerson/emberjs-xstate-example)\n\nAfter some experimentation with state machines and EmberJS, I figured it would be worth sharing some of our learnings with the broader JavaScript community. We’ve only just started building out components with [XState](https://xstate.js.org/), but I think we’re seeing the value already and plan to continue using it when building new components.\n\n### What are the benefits?\n\n* It forces us to reconcile component states upfront during planning\n* It’s a framework agnostic way of defining presentational state\n* It’s easy to unit test\n* You can generate state diagrams from the code you write\n* Template code can be greatly simplified\n* It eliminates emergent states by definition explicit states\n\n### What are the drawbacks?\n\n* It’s yet another dependency\n* XState has large conceptual overhead with lots of esoteric concepts\n* It’s confusing if you don’t have experience with it\n \n### The Plan\n\nThis is a contrived example, but I think it goes far enough to demonstrate the basics of using XState with EmberJS. We’re going to look at how we could use XState and Ember to implement a _(very)_ basic signup form.\n\nI won’t be explaining XState in great detail, for that I would suggest watching the [free video series on egghead.io](https://egghead.io/courses/introduction-to-state-machines-using-xstate). Instead, this article will introduce some basic concepts and demonstrate how we develop XState powered components in Ember.\n\n### The Form\n\nLet’s talk about this signup form. It’s going to have two fields, a submit button, an error state, and a success state. Check out the GIF below to see an example:\n\n![Screenshot](/emberjs-with-xstate/state-machine-example.gif)\n\nWhen the user puts in any value for `username` and `password` we will display a success message. Otherwise we will display an error message and allow them to retry.\n\n### The State machine\n\nIn abstract terms, this form will have 4 possible states: `idle`, `saving`, `success`, and `error`. Within XState we use the `createMachine` method to start defining our machine. The basic shape of an XState machine looks like this:\n\n```js\nimport { createMachine } from 'xstate';\n\ncreateMachine({\n  id: 'signup-form',\n  initial: 'idle',\n  states: {\n    idle: {},\n    saving: {},\n    success: {},\n    error: {},\n  },\n});\n```\n\nWhat’s so nice about this is that you can paste your code into the [XState Visualizer](https://xstate.js.org/viz/) and generate an visual of how your state machine operates – 🎉 super handy! 🎉\n\n![XState Visualization 1](/emberjs-with-xstate/initial-states.png)\n\n### Moving Between States\n\nOur state machine is not very useful yet. As defined, it cannot transition between states. To enable that, we need to define [events](https://xstate.js.org/docs/guides/events.html) for each state using the [`on` property](https://xstate.js.org/docs/guides/transitions.html).\n\n```js\nimport { createMachine } from 'xstate';\n\ncreateMachine({\n  id: 'signup-form',\n  initial: 'idle',\n  states: {\n    idle: {\n      on: {\n        SUBMIT: 'saving'\n      },\n    },\n    saving: {\n      on: {\n        SUCCESS: 'success',\n        ERROR: 'error'\n      },\n    },\n    success: {},\n    error: {\n      on: {\n        RETRY: 'idle',\n      },\n    },\n  },\n});\n\n``` \n\nWith our events defined, our state visualization starts to make a little more sense and we can now transition between states by sending our state machine an event. \n\n![XState Visualization 2](/emberjs-with-xstate/states-with-transitions.png)\n\n```js\n//=\u003e This would transition our machine to the `saving` state\nmachine.send({type: 'SUBMIT'});\n```\n\n### The Context Object\n\nThe next XState concept I want to touch on is the [`context` object](https://xstate.js.org/docs/guides/context.html). This is an object defined within our state machine that allows you to persist and pass around data. In our case we are going to store the `username` and `password`.\n\n```js\nimport { createMachine } from 'xstate';\n\ncreateMachine({\n  id: 'signup-form',\n  initial: 'idle',\n  // Lets add some context...\n  context: {\n    username: '',\n    password: '',\n  },\n  states: {\n    idle: {\n      on: {\n        SUBMIT: 'saving'\n      },\n    },\n    saving: {\n      on: {\n        SUCCESS: 'success',\n        ERROR: 'error'\n      },\n    },\n    success: {},\n    error: {\n      on: {\n        RETRY: 'idle',\n      },\n    },\n  },\n});\n```\n\nThere are a number of ways to set values on this context object, I’m going to give a simple example using an `action` callback. To learn more about actions I’d suggest [checking out the docs](https://xstate.js.org/docs/guides/actions.html), there is a lot to unpack.\n\n```js\n// When sending an event to the state machine you can pass extra data that becomes available in `action` callbacks\nmachine.send({\n  type: 'SUBMIT',\n  username: 'joe',\n  password: 'password123'\n});\n\n// ...\n// definition of our `idle` state\nidle: {\n  on: {\n    SUBMIT: {\n      target: 'saving', // transition to `saving`\n      actions: [\n        function(context, eventPayload) {\n          // eventPayload is the object we send to the machine\n          context.username = eventPayload.username;\n          context.password = eventPayload.password;\n        },\n      ],\n    },\n  },\n},\n// ...\n```\n\n### Saving the user (well… faking it anyway)\n\nThere are times when you may want a transition to be contingent on the results of an async operation. In our example, when the form is submitted we would likely hit the API and depending the result, transition to either the `success` or `error` state.\n\nTo accomplish this we can use the [`invoke` property](https://xstate.js.org/docs/guides/communication.html) when defining our `saving` state. There is a lot to know about `invoke`, but in its most simple form it allows you to register a callback that returns a promise. In our case if the promise is `resolved` we want to transition to the `success` state, and if it’s `rejected` we want to transition to the `error` state.\n\nThis looks something like this:\n\n```js\n\n// We define a \"service\" (callback) to invoke that returns a promise.\n// In our case I am trying to mock out an API call... notice how this callback recives the context object\nfunction fakeServerResponse(context) {\n  return new Promise((resolve, reject) =\u003e {\n    later(() =\u003e {\n      if (context.username \u0026\u0026 context.password) {\n        resolve('Valid!');\n      } else {\n        reject('Invalid!');\n      }\n    }, 1000);\n  });\n}\n\n\n// ...\n// definition of our `saving` state\nsaving: {\n  invoke: {\n    id: 'fakeServerResponse',\n    src: fakeServerResponse,\n    onDone: {\n      target: 'success',\n    },\n    onError: {\n      target: 'error',\n    },\n  },\n},\n// ...\n```\n\n### The Final State Machine\n\nBelow you will find the state machine in its entirety. I’ve made some slight adjustments to the action callback and added a couple extra properties, but it’s largely the same as we defined above.  The resulting state visualization awesome. Think about how helpful this could be when looking at a pull request.\n\n```js\nfunction fakeServerResponse(context) {\n  return new Promise((resolve, reject) =\u003e {\n    later(() =\u003e {\n      if (context.username \u0026\u0026 context.password) {\n        resolve('Valid!');\n      } else {\n        reject('Invalid!');\n      }\n    }, 1000);\n  });\n}\n\nlet signupFormMachine = createMachine({\n  id: 'signup-form',\n  initial: 'idle',\n  context: {\n    username: '',\n    password: '',\n  },\n  states: {\n    idle: {\n      on: {\n        SUBMIT: {\n          target: 'saving',\n          actions: [\n            assign({\n              username: (context, event) =\u003e event.username,\n              password: (context, event) =\u003e event.password,\n            }),\n          ],\n        },\n      },\n    },\n    saving: {\n      invoke: {\n        id: 'fakeServerResponse',\n        src: fakeServerResponse,\n        onDone: {\n          target: 'success',\n        },\n        onError: {\n          target: 'error',\n        },\n      },\n    },\n    success: {\n      type: 'final',\n    },\n    error: {\n      on: {\n        RETRY: 'idle',\n      },\n    },\n  },\n});\n```\n\n![Final State Machine](/emberjs-with-xstate/final-state-machine.png)\n\n### What About Ember?\n\nThis is actually the easy part! The basic premise here is that we instantiate our state machine within the constructor of our component. This allows us to hook into a `onTransition` callback that is exposed by XState. Every time our machine transitions, we update the `state` attribute of the component. This allows us to use simple logic in the component template to show or hide particular UI.\n\nWe also add two actions to the component. One that handles general `send` events to our machine and another that handles the form submit. I think it’s pretty self explanatory if you’re familiar with Ember.\n\n```js\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { later } from '@ember/runloop';\nimport { createMachine, interpret, assign } from 'xstate';\n\n// We would define the state machine here and assign it to a variable named \n// `signupFormMachine`. I've left this out for the sake of brevity, but you can see\n// it in the full source if needed.\n//\nlet signupFormMachine = createMachine(/* machine defined here */);\n\nexport default class SignupFormComponent extends Component {\n  @tracked state;\n  @tracked username;\n  @tracked password;\n\n  constructor() {\n    super(...arguments);\n    this.machine = interpret(signupFormMachine);\n    this.machine.start();\n    this.machine.onTransition((state) =\u003e {\n      this.state = state.value;\n    });\n  }\n\n  @action\n  send(eventName, e) {\n    e.preventDefault();\n    this.machine.send(eventName);\n  }\n\n  @action\n  submit(e) {\n    e.preventDefault();\n    this.machine.send({\n      type: 'SUBMIT',\n      username: this.username,\n      password: this.password,\n    });\n  }\n}\n```\n\n### Show Me the Handlebars!\n\nAlright, so let's check out the component template. It’s pretty clean and easy to read since everything is relying on the state machine. The big things I like about this are:\n\n* There is no potential for weird emergent states. Our template conditionals are very clearly defined in simple  `#if` blocks using `ember-truth-helper` subexpressions.\n* For simple button clicks, we can just use the `(fn this.send 'EVENT_NAME')` pattern to proxy messages directly to the state machine.\n* If we need to do some extra work before sending an event to the state machine you can use a standard ember action like we’ve done on the form submit event.\n\n```handlebars\n{{#if (or (eq this.state 'idle') (eq this.state 'saving'))}}\n\n  \u003cform {{on 'submit' this.submit}} class=\"signup-form\" autocomplete=\"off\"\u003e\n\n    \u003cdiv class=\"field\"\u003e\n      \u003clabel for=\"username\"\u003eUsername\u003c/label\u003e\n      \u003cInput @id=\"username\" @type=\"text\" @value={{this.username}} /\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class=\"field\"\u003e\n      \u003clabel for=\"password\"\u003ePassword\u003c/label\u003e\n      \u003cInput @id=\"password\" @type=\"password\" @value={{this.password}} /\u003e\n    \u003c/div\u003e\n\n    {{#if (eq this.state 'idle')}}\n      \u003cinput type=\"submit\" value=\"Create User\" /\u003e\n    {{/if}}\n\n    {{#if (eq this.state 'saving')}}\n      \u003cinput type=\"submit\" value=\"Saving...\" disabled /\u003e\n    {{/if}}\n\n  \u003c/form\u003e\n\n{{/if}}\n\n{{#if (eq this.state 'success')}}\n  \u003cdiv class=\"success\"\u003e\n    \u003cp\u003e⭐️ User created!\u003c/p\u003e\n  \u003c/div\u003e\n{{/if}}\n\n{{#if (eq this.state 'error')}}\n  \u003cdiv class=\"error\"\u003e\n    \u003cp\u003e🚫 There was an error submitting the form\u003c/p\u003e\n    \u003cbutton {{on 'click' (fn this.send 'RETRY')}}\u003e\n      Try Again...\n    \u003c/button\u003e\n  \u003c/div\u003e\n{{/if}}\n```\n\nI hope this has been a somewhat compelling introduction to using XState and EmberJS. If you have any questions or comments feel free to reach out on [Twitter](https://twitter.com/emerson_lackey) or on the EmberJS Discourse."}},"page":"/posts/[slug]","query":{"slug":"emberjs-with-xstate"},"buildId":"5HFY4gmHyiApkmp-53tjt","nextExport":true,"isFallback":false,"gip":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-144e5fa6fafab6397d9c.js"></script><script src="/_next/static/chunks/webpack-529038c3904b00e40c00.js" async=""></script><script src="/_next/static/chunks/framework.15878d4e523f86636251.js" async=""></script><script src="/_next/static/chunks/ef4d5ca1bb17fc2558817e2fd8d6e7eaac76ba76.2b2e1b1126c91ea98096.js" async=""></script><script src="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.edb164a1134a6009303e.js" async=""></script><script src="/_next/static/chunks/main-734e83a538b3a5a416d1.js" async=""></script><script src="/_next/static/chunks/pages/_app-4e6e1079dcade38a9395.js" async=""></script><script src="/_next/static/chunks/9f96d65d.e84e24a909b34e545eb6.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-0860a7ce36a19bae1b80.js" async=""></script><script src="/_next/static/5HFY4gmHyiApkmp-53tjt/_buildManifest.js" async=""></script><script src="/_next/static/5HFY4gmHyiApkmp-53tjt/_ssgManifest.js" async=""></script></body></html>